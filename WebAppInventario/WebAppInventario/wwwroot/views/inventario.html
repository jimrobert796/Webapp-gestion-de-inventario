<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Inventario</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <!-- Contenedor principal -->
    <div class="container mt-4">
        <!-- Tarjeta principal -->
        <div class="card shadow">
            <!-- Encabezado de la tarjeta -->
            <div class="card-header bg-primary text-white">
                <h2 class="mb-0">Gestión de Inventario</h2>
            </div>

            <!-- Cuerpo de la tarjeta -->
            <div class="card-body">
                <!-- Botones de acción y búsqueda en una fila -->
                <div class="row mb-3 align-items-center">
                    <!-- Botones CRUD al lado izquierdo -->
                    <div class="col-md-6">
                        <button id="btnNuevo" class="btn btn-primary">Nuevo Producto</button>
                        <button id="btnEditar" class="btn btn-warning" disabled>Editar</button>
                        <button id="btnEliminar" class="btn btn-danger" disabled>Eliminar</button>
                    </div>

                    <!-- Buscador al lado derecho -->
                    <div class="col-md-6">
                        <div class="input-group">
                            <span class="input-group-text bg-primary text-white">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text" class="form-control" id="inputBuscar" placeholder="Buscar por nombre de producto...">
                            <button class="btn btn-outline-secondary" type="button" id="btnLimpiarBusqueda" title="Limpiar búsqueda">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tabla de inventario con scroll responsive -->
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="tablaInventario">
                        <thead class="table-dark">
                            <tr>
                                <th>Nombre Producto</th>
                                <th>Proveedor</th>  <!-- Nueva columna -->
                                <th>Precio</th>
                                <th>Costo</th>
                                <th>Cantidad</th>
                                <th>Ubicación</th>
                                <th>Última Actualización</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los datos de inventario se cargan dinámicamente aquí -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== MODAL PARA AGREGAR/EDITAR PRODUCTO/INVENTARIO ========== -->
    <div class="modal fade" id="modalInventario" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <!-- Encabezado del modal -->
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="modalTitulo">Nuevo Producto</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <!-- Cuerpo del modal con formulario -->
                <div class="modal-body">
                    <form id="formInventario">
                        <!-- Campos ocultos -->
                        <input type="hidden" id="idInventario">
                        <input type="hidden" id="idProducto">

                        <!-- Sección Producto -->
                        <h6>Producto</h6>
                        <div class="mb-3">
                            <label for="idProveedor" class="form-label">Proveedor</label>
                            <select id="idProveedor" class="form-select" required>
                                <option value="">Seleccione un proveedor</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="idCategoria" class="form-label">Categoría</label>
                            <select id="idCategoria" class="form-select" required>
                                <option value="">Seleccione una categoría</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="codigo" class="form-label">Código</label>
                            <input type="text" class="form-control" id="codigo" required>
                        </div>
                        <div class="mb-3">
                            <label for="nombreProducto" class="form-label">Nombre Producto</label>
                            <input type="text" class="form-control" id="nombreProducto" required>
                        </div>
                        <div class="mb-3">
                            <label for="descripcion" class="form-label">Descripción</label>
                            <textarea class="form-control" id="descripcion" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="fechaProd" class="form-label">Fecha de Producción</label>
                            <input type="date" class="form-control" id="fechaProd">
                        </div>
                        <div class="mb-3">
                            <label for="fechaVenc" class="form-label">Fecha de Vencimiento</label>
                            <input type="date" class="form-control" id="fechaVenc">
                        </div>

                        <!-- Sección Inventario -->
                        <h6>Inventario</h6>
                        <div class="mb-3">
                            <label for="precio" class="form-label">Precio</label>
                            <input type="number" step="0.01" class="form-control" id="precio" required>
                        </div>
                        <div class="mb-3">
                            <label for="costo" class="form-label">Costo</label>
                            <input type="number" step="0.01" class="form-control" id="costo" required>
                        </div>
                        <div class="mb-3">
                            <label for="cantidad" class="form-control" id="cantidad" required></label>
                        </div>
                        <div class="mb-3">
                            <label for="ubicacion" class="form-label">Ubicación</label>
                            <input type="text" class="form-control" id="ubicacion" required>
                        </div>
                    </form>
                </div>

                <!-- Pie del modal con botones -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="btnGuardar">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== MODAL DE CONFIRMACIÓN DE ELIMINACIÓN ========== -->
    <div class="modal fade" id="modalEliminar" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">Confirmar Eliminación</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Mensaje de confirmación con nombre del producto -->
                    <p class="mb-0">¿Desea eliminar el producto <strong id="nombreProductoEliminar"></strong> del inventario?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                    <button type="button" class="btn btn-danger" id="btnConfirmarEliminar">Sí, Eliminar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== MODAL DE ÉXITO ========== -->
    <div class="modal fade" id="modalExito" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">Éxito</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Mensaje dinámico de éxito (se cambia desde JavaScript) -->
                    <p class="mb-0" id="mensajeExito"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal">Aceptar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== MODAL DE ERROR ========== -->
    <div class="modal fade" id="modalError" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">Error</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Mensaje dinámico de error (se cambia desde JavaScript) -->
                    <p class="mb-0" id="mensajeError"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>



    <!-- ========== JAVASCRIPT PRINCIPAL ========== -->
    <script>
        // IIFE (Immediately Invoked Function Expression) para encapsular el código
        (function () {
            // ========== VARIABLES GLOBALES ==========
            let inventarios = [];              // Array para almacenar todos los inventarios
            let inventariosFiltrados = [];     // Array para almacenar inventarios filtrados por búsqueda
            let proveedores = [];              // Array para proveedores
            let categorias = [];               // Array para categorías
            let filaSeleccionada = null;       // Índice de la fila seleccionada en la tabla
            let modoEdicion = false;           // Bandera para saber si estamos editando o agregando
            let modalInventario;               // Instancia del modal de inventario

            // ========== FUNCIÓN PARA FILTRAR INVENTARIOS POR BÚSQUEDA ==========
            function filtrarInventarios(textoBusqueda) {
                // Si no hay texto de búsqueda, mostrar todos
                if (!textoBusqueda || textoBusqueda.trim() === "") {
                    inventariosFiltrados = inventarios;
                    return;
                }

                // Convertir a minúsculas para búsqueda case-insensitive
                let busqueda = textoBusqueda.toLowerCase().trim();

                // Filtrar inventarios que coincidan en nombre de producto
                inventariosFiltrados = inventarios.filter(inv => {
                    let nombre = inv.productoNombre.toLowerCase();
                    return nombre.includes(busqueda);
                });
            }

            // ========== FUNCIÓN PARA RENDERIZAR LA TABLA ==========
            function renderTabla() {
                let tbody = $("#tablaInventario tbody");
                tbody.empty(); // Limpiar el contenido actual de la tabla

                // Determinar qué array mostrar (filtrado o completo)
                let datosAMostrar = inventariosFiltrados;

                // Si no hay inventarios, mostrar mensaje
                if (datosAMostrar.length === 0) {
                    let mensaje = inventarios.length === 0
                        ? "No hay productos en el inventario"
                        : "No se encontraron productos con ese criterio de búsqueda";
                    tbody.append(`
                                <tr>
                                    <td colspan="7" class="text-center text-muted">
                                        ${mensaje}
                                    </td>
                                </tr>
                            `);
                    return;
                }

                // Recorrer el array de inventarios y crear filas
                datosAMostrar.forEach((inv, i) => {
                    // Buscar el índice real en el array original
                    let indiceReal = inventarios.findIndex(invOrig => invOrig.idInventario === inv.idInventario);
                    tbody.append(`
                                <tr data-index="${indiceReal}">
                                    <td>${inv.productoNombre}</td>
                                    <td>${inv.productoproveedor}</td>  <!-- Nueva columna Proveedor -->
                                    <td>${inv.precio.toFixed(2)}</td>
                                    <td>${inv.costo.toFixed(2)}</td>
                                    <td>${inv.cantidad}</td>
                                    <td>${inv.ubicacion}</td>
                                    <td>${new Date(inv.ultimaActualizacion).toLocaleDateString()}</td>
                                </tr>
                            `);
                });

                // Agregar evento click a cada fila de la tabla
                $("#tablaInventario tbody tr").click(function () {
                    // No hacer nada si es la fila de "no hay inventarios"
                    if ($(this).find('td').length === 1) return;

                    // Remover la clase de selección de todas las filas
                    $("#tablaInventario tbody tr").removeClass("table-primary");
                    // Agregar clase de selección a la fila clickeada
                    $(this).addClass("table-primary");
                    // Guardar el índice de la fila seleccionada
                    filaSeleccionada = $(this).data("index");

                    // Habilitar los botones de Editar y Eliminar
                    $("#btnEditar, #btnEliminar").prop("disabled", false);
                });
            }

            // ========== FUNCIÓN PARA CARGAR PROVEEDORES ==========
            function cargarProveedores() {
                $.ajax({
                    url: "/api/Proveedores",
                    method: "GET",
                    success: function (data) {
                        proveedores = data;
                        let select = $("#idProveedor");
                        select.empty();
                        select.append('<option value="">Seleccione un proveedor</option>');
                        proveedores.forEach(prov => {
                            select.append(`<option value="${prov.idProveedor}">${prov.nombre.trim()}</option>`);
                        });
                    },
                    error: function (err) {
                        console.error("Error cargando proveedores:", err);
                    }
                });
            }

            // ========== FUNCIÓN PARA CARGAR CATEGORÍAS ==========
            function cargarCategorias() {
                $.ajax({
                    url: "/api/Categorias",
                    method: "GET",
                    success: function (data) {
                        categorias = data;
                        let select = $("#idCategoria");
                        select.empty();
                        select.append('<option value="">Seleccione una categoría</option>');
                        categorias.forEach(cat => {
                            select.append(`<option value="${cat.idCategoria}">${cat.nombre.trim()}</option>`);
                        });
                    },
                    error: function (err) {
                        console.error("Error cargando categorías:", err);
                    }
                });
            }

            // ========== FUNCIÓN PARA CARGAR INVENTARIOS ==========
            function cargarInventarios() {
                $.ajax({
                    url: "/api/Inventario",
                    method: "GET",
                    success: function (data) {
                        // Filtrar solo productos activos
                        inventarios = data
                            .filter(inv => inv.productoEstado)
                            .map(inv => ({
                                idInventario: inv.idInventario,
                                idProducto: inv.idProducto,
                                idProveedor: inv.idProveedor || '',
                                idCategoria: inv.idCategoria || '',
                                precio: Number(inv.precio),
                                costo: Number(inv.costo),
                                cantidad: Number(inv.cantidad),
                                ubicacion: inv.ubicacion.trim(),
                                ultimaActualizacion: inv.ultimaActualizacion,
                                productoCodigo: inv.productoCodigo.trim(),
                                productoNombre: inv.productoNombre.trim(),
                                productoDescripcion: inv.productoDescripcion.trim(),
                                productoFechaProd: inv.productoFechaProd,
                                productoFechaVenc: inv.productoFechaVenc,
                                productocategoria: inv.productocategoria.trim(),
                                productoproveedor: inv.productoproveedor.trim()
                            }));
                        inventariosFiltrados = inventarios; // Inicializar filtrados con todos
                        renderTabla(); // Actualizar la tabla con los datos
                    },
                    error: function (err) {
                        console.error("Error cargando inventario:", err);
                    }
                });
            }

            // ========== FUNCIÓN PARA LIMPIAR EL FORMULARIO ==========
            function limpiarFormulario() {
                $("#formInventario")[0].reset();  // Reset del formulario HTML
                $("#idInventario").val("");       // Limpiar el ID oculto
                $("#idProducto").val("");         // Limpiar el ID de producto
            }

            // ========== FUNCIÓN PARA ABRIR MODAL EN MODO "NUEVO" ==========
            function abrirModalNuevo() {
                modoEdicion = false;  // Indicar que estamos agregando
                limpiarFormulario();  // Limpiar el formulario
                // Configurar el título y botón para "Nuevo"
                $("#modalTitulo").text("Nuevo Producto");
                $("#btnGuardar").text("Guardar").removeClass("btn-warning").addClass("btn-primary");
                modalInventario.show();  // Mostrar el modal
            }

            // ========== FUNCIÓN PARA ABRIR MODAL EN MODO "EDITAR" ==========
            function abrirModalEditar() {
                // Validar que hay una fila seleccionada
                if (filaSeleccionada === null) {
                    alert("Seleccione un producto para editar");
                    return;
                }

                modoEdicion = true;  // Indicar que estamos editando
                let inv = inventarios[filaSeleccionada];  // Obtener datos del inventario

                // Llenar el formulario con los datos del inventario
                $("#idInventario").val(inv.idInventario);
                $("#idProducto").val(inv.idProducto);
                $("#idProveedor").val(inv.idProveedor);
                $("#idCategoria").val(inv.idCategoria);
                $("#codigo").val(inv.productoCodigo);
                $("#nombreProducto").val(inv.productoNombre);
                $("#descripcion").val(inv.productoDescripcion);
                $("#fechaProd").val(inv.productoFechaProd);
                $("#fechaVenc").val(inv.productoFechaVenc);
                $("#precio").val(inv.precio);
                $("#costo").val(inv.costo);
                $("#cantidad").val(inv.cantidad);
                $("#ubicacion").val(inv.ubicacion);

                // Configurar el título y botón para "Editar"
                $("#modalTitulo").text("Editar Producto");
                $("#btnGuardar").text("Guardar Cambios").removeClass("btn-primary").addClass("btn-warning");
                modalInventario.show();  // Mostrar el modal
            }

            // ========== FUNCIÓN PARA GUARDAR PRODUCTO/INVENTARIO (AGREGAR O EDITAR) ==========
            function guardarInventario() {
                // Validar que el formulario esté completo
                if (!$("#formInventario")[0].checkValidity()) {
                    $("#formInventario")[0].reportValidity();
                    return;
                }

                // Recopilar datos del formulario
                let datosProducto = {
                    idProveedor: Number($("#idProveedor").val()),
                    idCategoria: Number($("#idCategoria").val()),
                    codigo: $("#codigo").val(),
                    nombre: $("#nombreProducto").val(),
                    descripcion: $("#descripcion").val(),
                    estado: true,
                    fechaProd: $("#fechaProd").val() || null,
                    fechaVenc: $("#fechaVenc").val() || null
                };

                let datosInventario = {
                    precio: Number($("#precio").val()),
                    costo: Number($("#costo").val()),
                    cantidad: Number($("#cantidad").val()),
                    ubicacion: $("#ubicacion").val(),
                    ultimaActualizacion: new Date().toISOString().split('T')[0]
                };

                // ===== MODO EDICIÓN (PUT) =====
                if (modoEdicion) {
                    datosProducto.idProducto = Number($("#idProducto").val());
                    datosInventario.idInventario = Number($("#idInventario").val());
                    datosInventario.idProducto = datosProducto.idProducto;

                    // Actualizar producto primero
                    $.ajax({
                        url: `/api/Productos/${datosProducto.idProducto}`,
                        method: "PUT",
                        contentType: "application/json",
                        data: JSON.stringify(datosProducto),
                        success: function () {
                            // Luego actualizar inventario
                            $.ajax({
                                url: `/api/Inventario/${datosInventario.idInventario}`,
                                method: "PUT",
                                contentType: "application/json",
                                data: JSON.stringify(datosInventario),
                                success: function () {
                                    modalInventario.hide();  // Ocultar modal del formulario
                                    // Mostrar modal de éxito
                                    $("#mensajeExito").text("El producto fue actualizado exitosamente.");
                                    let modalExito = new bootstrap.Modal(document.getElementById('modalExito'));
                                    modalExito.show();
                                    // Recargar datos y resetear selección
                                    cargarInventarios();
                                    filaSeleccionada = null;
                                    $("#btnEditar, #btnEliminar").prop("disabled", true);
                                },
                                error: function (err) {
                                    console.error(err);
                                    modalInventario.hide();  // Ocultar modal del formulario
                                    // Mostrar modal de error
                                    $("#mensajeError").text("No se pudo actualizar el producto. Por favor, intente nuevamente.");
                                    let modalError = new bootstrap.Modal(document.getElementById('modalError'));
                                    modalError.show();
                                }
                            });
                        },
                        error: function (err) {
                            console.error(err);
                            modalInventario.hide();  // Ocultar modal del formulario
                            // Mostrar modal de error
                            $("#mensajeError").text("No se pudo actualizar el producto. Por favor, intente nuevamente.");
                            let modalError = new bootstrap.Modal(document.getElementById('modalError'));
                            modalError.show();
                        }
                    });
                }
                // ===== MODO AGREGAR (POST) =====
                else {
                    datosProducto.idProducto = 0;  // ID 0 para nuevo registro
                    datosInventario.idInventario = 0;

                    // Crear producto primero
                    $.ajax({
                        url: "/api/Productos",
                        method: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(datosProducto),
                        success: function (productoCreado) {
                            let idProductoNuevo = productoCreado.idProducto;
                            datosInventario.idProducto = idProductoNuevo;

                            // Luego crear inventario
                            $.ajax({
                                url: "/api/Inventario",
                                method: "POST",
                                contentType: "application/json",
                                data: JSON.stringify(datosInventario),
                                success: function () {
                                    modalInventario.hide();  // Ocultar modal del formulario
                                    // Mostrar modal de éxito
                                    $("#mensajeExito").text("El producto fue agregado exitosamente.");
                                    let modalExito = new bootstrap.Modal(document.getElementById('modalExito'));
                                    modalExito.show();
                                    // Recargar datos
                                    cargarInventarios();
                                },
                                error: function (err) {
                                    console.error(err);
                                    modalInventario.hide();  // Ocultar modal del formulario
                                    // Mostrar modal de error
                                    $("#mensajeError").text("No se pudo agregar el producto. Por favor, intente nuevamente.");
                                    let modalError = new bootstrap.Modal(document.getElementById('modalError'));
                                    modalError.show();
                                }
                            });
                        },
                        error: function (err) {
                            console.error(err);
                            modalInventario.hide();  // Ocultar modal del formulario
                            // Mostrar modal de error
                            $("#mensajeError").text("No se pudo agregar el producto. Por favor, intente nuevamente.");
                            let modalError = new bootstrap.Modal(document.getElementById('modalError'));
                            modalError.show();
                        }
                    });
                }
            }

            // ========== FUNCIÓN PARA MOSTRAR MODAL DE CONFIRMACIÓN DE ELIMINACIÓN ==========
            function eliminarInventario() {
                // Validar que hay una fila seleccionada
                if (filaSeleccionada === null) {
                    alert("Seleccione un producto para eliminar");
                    return;
                }

                let inv = inventarios[filaSeleccionada];

                // Mostrar el nombre del producto en el modal de confirmación
                $("#nombreProductoEliminar").text(inv.productoNombre);
                let modalEliminar = new bootstrap.Modal(document.getElementById('modalEliminar'));
                modalEliminar.show();
            }

            // ========== FUNCIÓN PARA CONFIRMAR Y EJECUTAR LA ELIMINACIÓN ==========
            function confirmarEliminacion() {
                let inv = inventarios[filaSeleccionada];
                let modalEliminar = bootstrap.Modal.getInstance(document.getElementById('modalEliminar'));

                // Soft Delete: actualizar estado del producto a false
                $.ajax({
                    url: `/api/Productos/${inv.idProducto}`,
                    method: "PUT",  // Usar PUT para soft delete
                    contentType: "application/json",
                    data: JSON.stringify({ estado: false }),
                    success: function () {
                        modalEliminar.hide();  // Ocultar modal de confirmación
                        // Mostrar modal de éxito
                        $("#mensajeExito").text("El producto fue eliminado exitosamente.");
                        let modalExito = new bootstrap.Modal(document.getElementById('modalExito'));
                        modalExito.show();
                        // Recargar datos y resetear selección
                        cargarInventarios();
                        filaSeleccionada = null;
                        $("#btnEditar, #btnEliminar").prop("disabled", true);
                    },
                    error: function (err) {
                        console.error(err);
                        modalEliminar.hide();  // Ocultar modal de confirmación
                        // Mostrar modal de error
                        $("#mensajeError").text("No se pudo eliminar el producto. Por favor, intente nuevamente.");
                        let modalError = new bootstrap.Modal(document.getElementById('modalError'));
                        modalError.show();
                    }
                });
            }

            // ========== INICIALIZACIÓN CUANDO EL DOCUMENTO ESTÁ LISTO ==========
            $(document).ready(function () {
                // Crear instancia del modal de inventario
                modalInventario = new bootstrap.Modal(document.getElementById('modalInventario'));

                // Cargar datos iniciales
                cargarProveedores();
                cargarCategorias();
                cargarInventarios();

                // ===== ASIGNAR EVENTOS A LOS BOTONES =====
                $("#btnNuevo").click(abrirModalNuevo);                    // Botón "Nuevo Producto"
                $("#btnEditar").click(abrirModalEditar);                  // Botón "Editar"
                $("#btnEliminar").click(eliminarInventario);              // Botón "Eliminar"
                $("#btnGuardar").click(guardarInventario);                // Botón "Guardar" en el modal
                $("#btnConfirmarEliminar").click(confirmarEliminacion);    // Botón "Sí, Eliminar"

                // ===== LIMPIAR FORMULARIO AL CERRAR EL MODAL =====
                $('#modalInventario').on('hidden.bs.modal', function () {
                    limpiarFormulario();
                });

                // ===== BÚSQUEDA EN TIEMPO REAL =====
                $("#inputBuscar").on("input", function () {
                    let textoBusqueda = $(this).val();
                    filtrarInventarios(textoBusqueda);
                    renderTabla();
                    // Resetear selección al buscar
                    filaSeleccionada = null;
                    $("#btnEditar, #btnEliminar").prop("disabled", true);
                });

                // ===== LIMPIAR BÚSQUEDA =====
                $("#btnLimpiarBusqueda").click(function () {
                    $("#inputBuscar").val("");
                    filtrarInventarios("");
                    renderTabla();
                    // Resetear selección
                    filaSeleccionada = null;
                    $("#btnEditar, #btnEliminar").prop("disabled", true);
                });
            });
        })();
    </script>
</body>
</html>